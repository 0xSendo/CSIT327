<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
</head>
<body>
    <div class="navbar">
        <a href="{% url 'navigation' %}#about-us">About Us</a>
        <a href="{% url 'navigation' %}#contacts">Contacts</a>
        <a href="{% url 'navigation' %}#social-media">Social Media</a>
        <a href="{% url 'navigation' %}#our-goal">Our Goal</a>
    </div>

    <div class="main-content">
        <div class="container">
            <h1>Academate Dashboard</h1>
            <div class="notification">
                <button id="notificationBtn" style="display: none;"></button>
            </div>
            <div class="grid" id="assignmentGrid">
                <!-- Assignment cards will appear here -->
            </div>

            <div id="myModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>Add New Assignment</h2>
                    <form id="assignmentForm">
                        <label for="subject_code">Subject Code:</label>
                        <input type="text" id="subject_code" name="subject_code" required>
                        <label for="name">Assignment Name:</label>
                        <input type="text" id="name" name="name" required>
                        <label for="due_date">Due Date:</label>
                        <input type="date" id="due_date" name="due_date" required>
                        <input type="submit" value="Add Assignment">
                    </form>
                </div>
            </div>

            <div id="editModal" class="modal">
                <div class="modal-content">
                    <span class="close" id="editClose">&times;</span>
                    <h2>Edit Assignment</h2>
                    <form id="editAssignmentForm">
                        <label for="editSubjectCode">Subject Code:</label>
                        <input type="text" id="editSubjectCode" name="editSubjectCode" required>
                        <label for="editName">Assignment Name:</label>
                        <input type="text" id="editName" name="editName" required>
                        <label for="editDueDate">Due Date:</label>
                        <input type="date" id="editDueDate" name="editDueDate" required>
                        <input type="submit" value="Update Assignment">
                    </form>
                </div>
            </div>

            <footer>
                <p>&copy; 2024 Academate. All Rights Reserved.</p>
                <button id="newAssignmentBtn">Add New Assignment</button>
                <a href="{% url 'journal' %}">
                    <button>Add Your Journal</button>
                </a>
                <a href="{% url 'landing' %}">
                    <button id="logoutBtn">Logout</button>
                </a>
            </footer>
        </div>
    </div>

    <script>
        let assignments = JSON.parse(localStorage.getItem('assignments')) || [
            { subjectCode: "MATH101", name: "Math Homework", dueDate: "2024-10-25" },
            { subjectCode: "SCI102", name: "Science Project", dueDate: "2024-10-30" },
            { subjectCode: "ENG103", name: "English Essay", dueDate: "2024-10-28" },
        ];

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function updateNotification() {
            const closestAssignment = assignments.reduce((prev, curr) => {
                return new Date(curr.dueDate) < new Date(prev.dueDate) ? curr : prev;
            });
            const notificationBtn = document.getElementById('notificationBtn');
            if (closestAssignment) {
                notificationBtn.textContent = `Next Assignment: ${closestAssignment.name} (Due: ${closestAssignment.dueDate})`;
                notificationBtn.style.display = "block";
            } else {
                notificationBtn.style.display = "none";
            }
        }

        function renderAssignments() {
            const assignmentGrid = document.getElementById('assignmentGrid');
            assignmentGrid.innerHTML = '';
            assignments.forEach((assignment, index) => {
                const card = document.createElement('div');
                card.className = 'assignment-card';
                card.innerHTML = `
                    <h3 style="background-color: ${getRandomColor()}">${assignment.subjectCode}</h3>
                    <p>${assignment.name}</p>
                    <p>Due Date: ${assignment.dueDate}</p>
                    <button onclick="editAssignment(${index})">Edit</button>
                    <button onclick="deleteAssignment(${index})">Mark as done</button>
                `;
                assignmentGrid.appendChild(card);
            });
        }

        function addAssignment(event) {
            event.preventDefault();
            const subjectCode = document.getElementById('subject_code').value;
            const name = document.getElementById('name').value;
            const dueDate = document.getElementById('due_date').value;

            const newAssignment = { subjectCode, name, dueDate };
            assignments.push(newAssignment);
            localStorage.setItem('assignments', JSON.stringify(assignments));

            document.getElementById('myModal').classList.remove('show');
            renderAssignments();
            updateNotification();
        }

        function editAssignment(index) {
            const assignment = assignments[index];
            document.getElementById('editSubjectCode').value = assignment.subjectCode;
            document.getElementById('editName').value = assignment.name;
            document.getElementById('editDueDate').value = assignment.dueDate;

            document.getElementById('editModal').classList.add('show');
            document.getElementById('editAssignmentForm').onsubmit = (event) => updateAssignment(event, index);
        }

        function updateAssignment(event, index) {
            event.preventDefault();
            const subjectCode = document.getElementById('editSubjectCode').value;
            const name = document.getElementById('editName').value;
            const dueDate = document.getElementById('editDueDate').value;

            assignments[index] = { subjectCode, name, dueDate };
            localStorage.setItem('assignments', JSON.stringify(assignments));

            document.getElementById('editModal').classList.remove('show');
            renderAssignments();
            updateNotification();
        }

        function deleteAssignment(index) {
            assignments.splice(index, 1);
            localStorage.setItem('assignments', JSON.stringify(assignments));
            renderAssignments();
            updateNotification();
        }

        document.getElementById('newAssignmentBtn').addEventListener('click', () => {
            document.getElementById('myModal').classList.add('show');
        });

        document.querySelectorAll('.close').forEach(element => {
            element.addEventListener('click', () => {
                document.getElementById('myModal').classList.remove('show');
                document.getElementById('editModal').classList.remove('show');
            });
        });

        document.getElementById('assignmentForm').addEventListener('submit', addAssignment);

        renderAssignments();
        updateNotification();
    </script>
</body>
</html>
