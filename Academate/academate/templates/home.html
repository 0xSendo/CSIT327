<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="static/css/home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="main-content">
        <div class="container">
            <div class="notification">
                <button id="notificationBtn" style="display: none;"></button>
            </div>
            <h1>Academate</h1>
            <div class="navbar">
                <a href="#"><i class="fa fa-fw fa-home"></i> Home</a>
                <a href="#"><i class="fa fa-fw fa-book"></i> Journal</a>
                <a href="#"><i class="fa fa-fw fa-search"></i> Search</a>
                <a href="{% url 'logout' %}" class="split"><i class="fa fa-fw fa-user"></i> Logout</a>
            </div>
            <div class="mainthing">
                <button id="newAssignmentBtn" class="buttonAss">Add New Assignment</button>
                <div class="gridbackground">
                    <div class="grid" id="assignmentGrid">
                        <!-- Existing assignment cards will be dynamically rendered here -->
                    </div>
                    

                    <!-- New Assignment Modal -->
                    <div id="myModal" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h2>Add New Assignment</h2>
                            <form id="assignmentForm">
                                <label for="subject_code">Subject Code:</label>
                                <input type="text" id="subject_code" name="subject_code" required>
                                <label for="name">Assignment Name:</label>
                                <input type="text" id="name" name="name" required>
                                <label for="due_date">Due Date:</label>
                                <input type="date" id="due_date" name="due_date" required>
                                <input type="submit" value="Add Assignment">
                            </form>
                        </div>
                    </div>

                    <!-- Edit Modal -->
                    <div id="editModal" class="modal">
                        <div class="modal-content">
                            <span class="close" id="editClose">&times;</span>
                            <h2>Edit Assignment</h2>
                            <form id="editAssignmentForm">
                                <label for="editSubjectCode">Subject Code:</label>
                                <input type="text" id="editSubjectCode" name="editSubjectCode" required>
                                <label for="editName">Assignment Name:</label>
                                <input type="text" id="editName" name="editName" required>
                                <label for="editDueDate">Due Date:</label>
                                <input type="date" id="editDueDate" name="editDueDate" required>
                                <input type="submit" value="Update Assignment">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2024 Academate. All Rights Reserved.</p>
    </footer>
    <script>
        let assignments = JSON.parse(localStorage.getItem('assignments')) || [
            { subjectCode: "MATH101", name: "Math Homework", dueDate: "2024-10-25" },
            { subjectCode: "SCI102", name: "Science Project", dueDate: "2024-10-30" },
            { subjectCode: "ENG103", name: "English Essay", dueDate: "2024-10-28" },
        ];

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function updateNotification() {
            const closestAssignment = assignments.reduce((prev, curr) => {
                return new Date(curr.dueDate) < new Date(prev.dueDate) ? curr : prev;
            });
            const notificationBtn = document.getElementById('notificationBtn');
            if (closestAssignment) {
                notificationBtn.textContent = `Next Assignment: ${closestAssignment.name} (Due: ${closestAssignment.dueDate})`;
                notificationBtn.style.display = "block";
            } else {
                notificationBtn.style.display = "none";
            }
        }

        function renderAssignments() {
            const grid = document.getElementById('assignmentGrid');
            grid.innerHTML = '';

            assignments.forEach((assignment, index) => {
                const card = document.createElement('div');
                card.className = 'assignment-card';
                card.innerHTML = `
                    <div class="subject-box" style="background-color: ${getRandomColor()};"></div>
                    <h3>${assignment.name}</h3>
                    <p class="subject-code">${assignment.subjectCode}</p>
                    <p class="due-date">${assignment.dueDate}</p>
                    <button class="edit-btn" onclick="editAssignment(${index})">Edit</button>
                    <button class="mark-done-btn" onclick="markAsDone(${index})">Mark as Done</button>
                `;
                grid.appendChild(card);
            });
        }

        function markAsDone(index) {
            if (confirm("Are you sure you want to mark this assignment as done?")) {
                assignments.splice(index, 1); // Remove the assignment from the array
                localStorage.setItem('assignments', JSON.stringify(assignments));
                updateNotification();
                renderAssignments();
            }
        }

        function editAssignment(index) {
            const assignment = assignments[index];
            document.getElementById('editSubjectCode').value = assignment.subjectCode;
            document.getElementById('editName').value = assignment.name;
            document.getElementById('editDueDate').value = assignment.dueDate;

            const editModal = document.getElementById("editModal");
            editModal.style.display = "block";

            document.getElementById('editAssignmentForm').onsubmit = function(e) {
                e.preventDefault();
                const editedSubjectCode = document.getElementById('editSubjectCode').value;
                const editedName = document.getElementById('editName').value;
                const editedDueDate = document.getElementById('editDueDate').value;

                assignments[index] = { subjectCode: editedSubjectCode, name: editedName, dueDate: editedDueDate };
                localStorage.setItem('assignments', JSON.stringify(assignments));
                updateNotification();
                renderAssignments();
                editModal.style.display = "none"; // Close the edit modal
            };
        }

        document.getElementById('newAssignmentBtn').onclick = function() {
            const modal = document.getElementById("myModal");
            modal.style.display = "block";
        };

        document.getElementById('assignmentForm').onsubmit = function(e) {
            e.preventDefault();
            const subjectCode = document.getElementById('subject_code').value;
            const name = document.getElementById('name').value;
            const dueDate = document.getElementById('due_date').value;

            assignments.push({ subjectCode, name, dueDate });
            localStorage.setItem('assignments', JSON.stringify(assignments));
            updateNotification();
            renderAssignments();

            document.getElementById('myModal').style.display = "none"; // Close the modal
        };

        const modalCloseButtons = document.querySelectorAll('.close');
        modalCloseButtons.forEach(button => {
            button.onclick = function() {
                this.closest('.modal').style.display = "none"; // Close modal on button click
            };
        });

        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = "none"; // Close modal if user clicks outside of it
                }
            });
        };

        window.onload = function() {
            renderAssignments();
            updateNotification();
        };
    </script>
</body>
</html>
